<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NewtService.Tray.ViewModels"
        xmlns:conv="using:NewtService.Tray.Converters"
        x:Class="NewtService.Tray.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Newt VPN"
        Width="580"
        Height="390"
        WindowStartupLocation="CenterScreen"
        CanResize="False"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="PreferSystemChrome"
        Background="#1a1a2e">

    <Window.Resources>
        <conv:StatusColorConverter x:Key="StatusColorConverter"/>
    </Window.Resources>

    <Window.Styles>
        <Style Selector="TextBlock.header">
            <Setter Property="FontSize" Value="22"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#ffffff"/>
        </Style>
        <Style Selector="TextBlock.subheader">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#8b8b9a"/>
        </Style>
        <Style Selector="TextBlock.label">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="#8b8b9a"/>
            <Setter Property="Margin" Value="0,8,0,4"/>
        </Style>
        <Style Selector="TextBox">
            <Setter Property="Background" Value="#252542"/>
            <Setter Property="BorderBrush" Value="#3d3d5c"/>
            <Setter Property="Foreground" Value="#ffffff"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
        <Style Selector="TextBox:focus /template/ Border">
            <Setter Property="BorderBrush" Value="#4CAF50"/>
        </Style>
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="#ffffff"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#66BB6A"/>
        </Style>
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#3d3d5c"/>
            <Setter Property="Foreground" Value="#ffffff"/>
            <Setter Property="BorderBrush" Value="#4d4d6c"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <Style Selector="Button.secondary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#4d4d6c"/>
        </Style>
        <Style Selector="Button.secondary:disabled /template/ ContentPresenter">
            <Setter Property="Background" Value="#252542"/>
            <Setter Property="Foreground" Value="#6a6a7a"/>
        </Style>
        <Style Selector="Button.update">
            <Setter Property="Background" Value="#1976D2"/>
            <Setter Property="Foreground" Value="#ffffff"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <Style Selector="Button.update:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#1E88E5"/>
        </Style>
        <Style Selector="Button.link">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#4a4a5a"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="10"/>
        </Style>
        <Style Selector="Button.link:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#6a6a7a"/>
        </Style>
        <Style Selector="Button.icon">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#6a6a7a"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="16"/>
        </Style>
        <Style Selector="Button.icon:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#252542"/>
            <Setter Property="Foreground" Value="#ffffff"/>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="*,Auto,Auto" Margin="20,32,20,12">
        <StackPanel Grid.Row="0" Spacing="0">
            
            <!-- Header -->
            <Grid Margin="0,0,0,6">
                <TextBlock Classes="header" Text="Newt VPN"/>
                <Button Classes="icon" Content="⚙" ToolTip.Tip="Settings" 
                        HorizontalAlignment="Right" VerticalAlignment="Top"
                        Command="{Binding OpenSettingsCommand}"/>
            </Grid>

            <!-- Form -->
            <TextBlock Classes="label" Text="ENDPOINT" Margin="0,0,0,4"/>
            <TextBox Text="{Binding Endpoint}" Watermark="https://app.pangolin.net"/>
            
            <TextBlock Classes="label" Text="ID"/>
            <TextBox Text="{Binding ClientId}" Watermark="Your client ID"/>
            
            <TextBlock Classes="label" Text="SECRET"/>
            <TextBox Text="{Binding Secret}" PasswordChar="•" Watermark="Your client secret"/>
            
            <!-- Status -->
            <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,12,0,0" HorizontalAlignment="Center">
                <TextBlock Classes="subheader" Text="{Binding Status}" 
                           Foreground="{Binding IsRunning, Converter={StaticResource StatusColorConverter}}"/>
                <TextBlock Classes="subheader" Text=" • Newt "/>
                <TextBlock Classes="subheader" Text="{Binding Version}"/>
                <TextBlock Classes="subheader" Text=" • App v"/>
                <TextBlock Classes="subheader" Text="{Binding AppVersion}"/>
            </StackPanel>
        </StackPanel>

        <!-- All Buttons Row -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="6" Margin="0,14,0,0" HorizontalAlignment="Center">
            <Button Classes="secondary" Content="Check Service" Command="{Binding CheckServiceCommand}"/>
            <Button Classes="update" Content="Check for Updates">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuItem Header="{Binding UpdateButtonText}" Command="{Binding CheckUpdateCommand}"/>
                        <MenuItem Header="{Binding AppUpdateButtonText}" Command="{Binding CheckAppUpdateCommand}"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <Button Classes="secondary" Content="Service Control" IsEnabled="{Binding IsInstalled}">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuItem Header="Start" Command="{Binding StartCommand}"/>
                        <MenuItem Header="Stop" Command="{Binding StopCommand}"/>
                        <MenuItem Header="Restart" Command="{Binding RestartCommand}"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <Button Classes="primary" Content="Save" Command="{Binding SaveConfigCommand}"/>
        </StackPanel>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20" Margin="0,10,0,0">
            <Button Classes="link" Content="Open Logs">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuItem Header="App Logs" Command="{Binding OpenAppLogsCommand}"/>
                        <MenuItem Header="Newt Logs" Command="{Binding OpenNewtLogsCommand}"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <Button Classes="link" Content="NewtService" Command="{Binding OpenGitHubCommand}"/>
        </StackPanel>
    </Grid>
</Window>
